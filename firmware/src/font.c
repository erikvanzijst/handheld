#include <avr/pgmspace.h>
#include <compiler.h>
#include <ctype.h>
#include <string.h>
#include <stdio.h>

// partial minimalist 5x5 font from https://www.dafont.com/5x5.font
const uint8_t font[43][5] PROGMEM = {
  {0x1f, 0x13, 0x15, 0x19, 0x1f}, // 0
  {0x04, 0x0c, 0x04, 0x04, 0x0e}, // 1
  {0x1e, 0x01, 0x0e, 0x10, 0x1f}, // 2
  {0x1f, 0x01, 0x0e, 0x01, 0x1f}, // 3
  {0x10, 0x10, 0x14, 0x1f, 0x04}, // 4
  {0x1f, 0x10, 0x1e, 0x01, 0x1e}, // 5
  {0x1f, 0x10, 0x1f, 0x11, 0x1f}, // 6
  {0x1f, 0x01, 0x02, 0x04, 0x04}, // 7
  {0x1f, 0x11, 0x1f, 0x11, 0x1f}, // 8
  {0x1f, 0x11, 0x1f, 0x01, 0x1f}, // 9

  {0x0, 0x04, 0x0, 0x04, 0x0},    // :
  {0x0, 0x04, 0x0, 0x04, 0x04},   // ;
  {0, 0, 0, 0, 0},  // <
  {0, 0, 0, 0, 0},  // =
  {0, 0, 0, 0, 0},  // >
  {0, 0, 0, 0, 0},  // ?
  {0, 0, 0, 0, 0},  // fake space

  {0x1f, 0x11, 0x11, 0x1f, 0x11}, // A
  {0x1f, 0x11, 0x1e, 0x11, 0x1f}, // B
  {0x1f, 0x10, 0x10, 0x10, 0x1f}, // C
  {0x1e, 0x11, 0x11, 0x11, 0x1e}, // D
  {0x1f, 0x10, 0x1e, 0x10, 0x1f}, // E
  {0x1f, 0x10, 0x1e, 0x10, 0x10}, // F
  {0x1f, 0x10, 0x13, 0x11, 0x1f}, // G
  {0x11, 0x11, 0x1f, 0x11, 0x11}, // H
  {0x1f, 0x04, 0x04, 0x04, 0x1f}, // I
  {0x03, 0x01, 0x01, 0x11, 0x1f}, // J
  {0x11, 0x12, 0x1c, 0x12, 0x11}, // K
  {0x10, 0x10, 0x10, 0x10, 0x1f}, // L
  {0x11, 0x1b, 0x15, 0x11, 0x11}, // M
  {0x11, 0x19, 0x15, 0x13, 0x11}, // N
  {0x0e, 0x11, 0x11, 0x11, 0x0e}, // O
  {0x1e, 0x11, 0x1e, 0x10, 0x10}, // P
  {0x1f, 0x11, 0x11, 0x1f, 0x04}, // Q
  {0x1e, 0x11, 0x1e, 0x11, 0x11}, // R
  {0x1f, 0x10, 0x1f, 0x01, 0x1f}, // S
  {0x1f, 0x04, 0x04, 0x04, 0x04}, // T
  {0x11, 0x11, 0x11, 0x11, 0x1f}, // U
  {0x11, 0x11, 0x0a, 0x0a, 0x04}, // V
  {0x11, 0x11, 0x15, 0x15, 0x0a}, // W
  {0x11, 0x0a, 0x04, 0x0a, 0x11}, // X
  {0x11, 0x11, 0x0a, 0x04, 0x04}, // Y
  {0x1f, 0x02, 0x04, 0x08, 0x1f}  // Z
};

int to_glyphs(uint8_t *glyphs, const char *str) {
  for (unsigned int i = 0; i < strlen(str); i++) {
    const uint8_t j = ((uint8_t)str[i]) == 0x20 ? 0x10 : ((uint8_t)toupper(str[i])) - 0x30; // space is mapped to @
    if (j < 0 || j > 43) {
      printf("Invalid character! 0x%0.2x\r\n", str[i]);
      return -1;
    }
    memcpy_P(glyphs + i*5, &(font[j]), 5);
  }
  return 0;
}
